<!doctype html>
<html>

<head>
    <title>River Levels NE</title>
    <meta name="description" content="Kayaking River Levels in the North East">
    <meta name="keywords" content="kayaking levels north east">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js/dist/chart.min.js"></script>
    <script
        src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1">

</head>

<body>
    <script>
        const d = new Date();
        d.setDate(d.getDate() - 5);

        sections = [
            {
                river: 'Tees',
                section: 'High Force to Scooberry Bridge',
                scrape: 0.35,
                low: 0.5,
                medium: 0.75,
                high: 1.1,
                huge: 1.3,
                measure: "F3505-level-stage-i-15_min-m"
            },
            {
                river: 'Tees',
                section: 'Barnard Castle to Winston Bridge',
                scrape: 0.45,
                low: 0.55,
                medium: 0.85,
                high: 1.05,
                huge: 1.5,
                measure: "F3504-level-stage-i-15_min-m"
            },
            {
                river: 'Irthing',
                section: 'Crammel Linn to Gilsand',
                scrape: 0.35,
                low: 0.4,
                medium: 0.48,
                high: 0.55,
                huge: 0.8,
                measure: "763117-level-stage-i-15_min-m"
            },
            {
                river: 'North Tyne',
                section: 'Chollerford to Hexham',
                scrape: 0.4,
                low: 0.6,
                medium: 1.1,
                high: 1.9,
                huge: 2.5,
                measure: "023003-level-stage-i-15_min-m"
            },
        ]

        Promise.all(sections.map(s => {
            return fetch(`https://environment.data.gov.uk/flood-monitoring/id/measures/${s.measure}/readings/?since=${d.toISOString()}&_sorted`,
                {
                    method: "GET"
                }
            ).then((response) => response.json())
        })).then(levels => levels.forEach((measure, idx) => {
            const div = document.createElement("div")
            const canvas = document.createElement("canvas");
            canvas.setAttribute("id", `chart-${idx})`);
            canvas.setAttribute("height", "100px");
            const heading = document.createElement("H4");
            heading.appendChild(document.createTextNode(`${sections[idx].river} - ${sections[idx].section}`))
            div.appendChild(heading)
            div.appendChild(canvas)
            document.body.appendChild(div)

            const myChart = new Chart(
                canvas,
                {
                    type: 'line',
                    data: {
                        datasets: [{
                            data: measure.items.map(p => {
                                return { x: p.dateTime, y: p.value }
                            })
                        }]
                    },
                    options: {
                        elements: {
                            line: { borderColor: '#3F84E6' },
                            point: {
                                radius: 0
                            }
                        },
                        scales: {
                            x: {
                                type: 'time',
                                time: { unit: 'day' }
                            }
                        },
                        plugins: {
                            legend: {
                                display: false
                            }
                        }
                    }
                }
            );
        }))

    </script>
</body>

</html>